# Story 10.8: Saved Views & URL State

## Status
Draft

## Story
**As a** operator,
**I want** filters and layout choices to sync to `st.query_params` so reloading restores my saved view and, when query params are missing, the page falls back to a local preference file,
**so that** I can maintain my preferred workspace configuration across sessions.

## Acceptance Criteria
1. Filter and toggle state (bookmaker, bet type, confidence, compact mode, auto-refresh) sync to `st.query_params` and update the URL whenever the operator changes them.
2. Reloading a URL rehydrates the same selections, and when query params are not provided the page reads from a secure local pref file that expires after 30 days.
3. Page captions document the saved-view behavior so operators know their filters are persistent, echoing the front-end goals in `docs/front-end-spec.md:1`.

## Tasks / Subtasks
- [ ] Implement query parameter synchronization (AC: #1)
  - [ ] Wrap existing filter state in helpers that read/write query params
  - [ ] Sync bookmaker filter state to `st.query_params`
  - [ ] Sync bet type filter state to `st.query_params`
  - [ ] Sync confidence filter state to `st.query_params`
  - [ ] Sync compact mode toggle state to `st.query_params`
  - [ ] Sync auto-refresh toggle state to `st.query_params`
  - [ ] Update URL whenever operator changes any filter or toggle
  - [ ] Reference existing feature flags at `src/ui/utils/feature_flags.py:89`
- [ ] Implement view rehydration and fallback (AC: #2)
  - [ ] Add URL rehydration logic on page load to restore selections
  - [ ] Implement local preference file serialization (JSON or similar)
  - [ ] Add secure local preference storage for browsers without stable query params
  - [ ] Implement 30-day expiration for local preference files
  - [ ] Create fallback mechanism when query params are not provided
  - [ ] Ensure preference loading priority: URL params > local prefs > defaults
- [ ] Add user documentation and captions (AC: #3)
  - [ ] Add page captions explaining saved-view behavior
  - [ ] Document filter persistence for operators
  - [ ] Reference front-end goals in `docs/front-end-spec.md:1`
  - [ ] Ensure clear communication about data persistence
  - [ ] Add help text explaining how preferences are stored

## Dev Notes
- Reference existing feature flags implementation at `src/ui/utils/feature_flags.py:89`
- Keep stored preferences PII-free to protect user privacy
- Encrypt or obfuscate file names to avoid exposing sensitive data
- Consider URL length limitations for query parameters
- Test preference synchronization across different browser environments
- Ensure local preference file cleanup after expiration

### Testing
- Test file location: `tests/unit/test_saved_views_url_state.py`
- Test standards: Follow existing unit test patterns in the codebase
- Testing frameworks: pytest with mock for browser storage
- Unit tests verify query params and local pref values load and save correctly
- Test URL rehydration with various filter combinations
- Test local preference file serialization and deserialization
- Verify 30-day expiration functionality
- Test fallback behavior when query params are missing
- Validate PII-free storage implementation
- Test preference synchronization across page refreshes

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-10 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
<!-- To be populated by dev agent -->

### Debug Log References
<!-- To be populated by dev agent -->

### Completion Notes List
<!-- To be populated by dev agent -->

### File List
<!-- To be populated by dev agent -->

## QA Results
<!-- To be populated by QA agent -->
