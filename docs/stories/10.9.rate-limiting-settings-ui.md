# Story 10.9: Rate Limiting Settings UI

## Status
Draft

## Story
**As a** operator,
**I need** a UI to view and adjust per-chat coverage proof rate limits with inline guidance about Telegram caps so I can tune delivery without violating the service guardrails,
**so that** I can optimize message delivery rates while staying within Telegram's limits.

## Acceptance Criteria
1. UI lists coverage proof thresholds for each chat (messages per interval, burst allowance) populated from the service constants.
2. Operators can edit thresholds with validation that keeps values within safe bounds; inline help explains Telegram caps before saving.
3. A preview badge summarizes the effective rate limit (for example 1 msg/sec global, 1 msg/60s per chat) so operators see the impact immediately.
4. Saving changes persists the values (either in Streamlit config or a settings table) and shows a toast with when the new limits take effect, plus logs the operator update.

## Tasks / Subtasks
- [ ] Create rate limiting settings UI display (AC: #1)
  - [ ] Build UI component to list coverage proof thresholds per chat
  - [ ] Populate thresholds from `CoverageProofService` constants at `src/services/coverage_proof_service.py:47,520`
  - [ ] Display messages per interval and burst allowance for each chat
  - [ ] Add visual indicators for current rate limit status
  - [ ] Reuse existing `CoverageProofService` state to populate the form
- [ ] Implement threshold editing with validation (AC: #2)
  - [ ] Add edit functionality for rate limit thresholds
  - [ ] Implement validation logic to prevent values that exceed Telegram limits
  - [ ] Add inline help explaining Telegram caps before saving
  - [ ] Create input validation with safe bounds checking
  - [ ] Add real-time validation feedback as operators edit values
- [ ] Create rate limit preview functionality (AC: #3)
  - [ ] Build preview badge component showing effective rate limits
  - [ ] Display summary in format like "1 msg/sec global, 1 msg/60s per chat"
  - [ ] Update preview in real-time as operators adjust values
  - [ ] Add visual indicators for when limits are within/beyond safe bounds
- [ ] Implement settings persistence and feedback (AC: #4)
  - [ ] Add save functionality for rate limit changes
  - [ ] Persist values to Streamlit config or settings table
  - [ ] Implement toast notifications showing when new limits take effect
  - [ ] Add operator update logging for audit trail
  - [ ] Ensure persistence store integrates with service startup configuration

## Dev Notes
- Reference service guardrails at `src/services/coverage_proof_service.py:47,520`
- Persist values to the same store the service uses on startup or to a new settings row linked to the coverage proof sender
- Consider real-time validation feedback for better UX
- Ensure settings changes don't disrupt ongoing message delivery
- Test rate limit changes across different chat configurations
- Consider rollback functionality for problematic settings changes

### Testing
- Test file locations:
  - `tests/unit/test_rate_limiting_settings.py`
  - `tests/unit/test_navigation_modernization.py`
- Test standards: Follow existing unit test patterns in the codebase
- Testing frameworks: pytest with form validation testing
- Unit tests cover validation/persistence functionality
- Test UI population from `CoverageProofService` constants
- Verify validation prevents values that exceed Telegram limits
- Test preview badge accuracy with various rate limit combinations
- Test settings persistence and loading
- Ensure `tests/unit/test_navigation_modernization.py:1` ensures the Rate Limiting page is discoverable from navigation
- Test toast notifications and logging functionality

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-10 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
<!-- To be populated by dev agent -->

### Debug Log References
<!-- To be populated by dev agent -->

### Completion Notes List
<!-- To be populated by dev agent -->

### File List
<!-- To be populated by dev agent -->

## QA Results
<!-- To be populated by QA agent -->
