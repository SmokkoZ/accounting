# Story 10.4: Auto-refresh Default On

## Status
Draft

## Story
**As a** operator,
**I want** the incoming bets queue to default to auto-refresh when fragment support is available,
**so that** I can monitor the flow of bets without manually toggling the setting.

## Acceptance Criteria
1. Auto-refresh now defaults to ON whenever fragments are supported, but the operator can still disable it via the toggle.
2. The refresh loop respects the spinner rate limit (no thrash) by only running once per configured interval and by using the fragment update when available.
3. The current toggle state is visible in the UI and stored in session/query params for persistence.

## Tasks / Subtasks
- [ ] Implement auto-refresh default behavior (AC: #1)
  - [ ] Check fragment support availability on page load
  - [ ] Set auto-refresh toggle to ON by default when fragments are supported
  - [ ] Maintain manual toggle functionality for operators to disable auto-refresh
  - [ ] Reference existing fragment flag at `src/ui/pages/1_incoming_bets.py:670`
- [ ] Optimize refresh loop to prevent thrashing (AC: #2)
  - [ ] Implement rate limiting to ensure refresh runs only once per configured interval
  - [ ] Use fragment update mechanism when available for efficient updates
  - [ ] Add spinner state management to prevent visual thrashing
  - [ ] Ensure refresh loop disables cleanly when toggle is turned off
- [ ] Implement toggle state persistence (AC: #3)
  - [ ] Add visual indicator for current auto-refresh toggle state in UI
  - [ ] Store toggle state in session storage
  - [ ] Add query parameter support for toggle state
  - [ ] Ensure toggle state persists across page refreshes

## Dev Notes
- Fall back to the old manual refresh when fragments are not supported
- Reference existing fragment implementation around `src/ui/pages/1_incoming_bets.py:670`
- Ensure the refresh schedule uses the existing interval configuration
- Consider performance implications of auto-refresh on server load
- Test fragment support detection across different browsers/environments

### Testing
- Test file location: `tests/unit/test_incoming_bets_auto_refresh.py`
- Test standards: Follow existing unit test patterns in the codebase
- Testing frameworks: pytest with mock for fragment support detection
- Regression test to prove the spinner never thrashes while auto-refresh runs (could be a unit test for the toggled loop)
- Test auto-refresh default behavior with fragment support enabled/disabled
- Verify toggle state persistence across page refreshes
- Test rate limiting functionality to prevent refresh thrashing
- Ensure fallback to manual refresh works when fragments are not supported

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-10 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
<!-- To be populated by dev agent -->

### Debug Log References
<!-- To be populated by dev agent -->

### Completion Notes List
<!-- To be populated by dev agent -->

### File List
<!-- To be populated by dev agent -->

## QA Results
<!-- To be populated by QA agent -->
