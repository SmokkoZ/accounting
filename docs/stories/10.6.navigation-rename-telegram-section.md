# Story 10.6: Navigation Rename & Telegram Section

## Status
Ready for Review

## Story
**As a** operator,
**I want** the navigation label to say "Settlement" instead of "Verified Bets Queue", to get a dedicated Telegram section, and to see live balances on the Associates page,
**so that** I can navigate more intuitively and access relevant information more efficiently.

## Acceptance Criteria
1. The main navigation label reads "Settlement" and keeps "Surebets" for discovery (update at `src/ui/app.py:105`).
2. A new Telegram section links to Pending Photos, Coverage Proof Outbox, and Rate Limiting pages.
3. The Admin & Associates listing now surfaces `balance` and `pending_balance` instead of JSON profile/created/updated columns, and sorting/filtering use these new fields via `AssociateHubRepository`.
4. `tests/unit/test_navigation_modernization.py:1` asserts the Settlement label and Telegram section exist.
5. `tests/unit/test_associate_hub_repository.py:1` covers the new fields so data is available to the UI.

## Tasks / Subtasks
- [x] Update main navigation label and structure (AC: #1)
  - [x] Change navigation label from "Verified Bets Queue" to "Settlement" at `src/ui/app.py:105`
  - [x] Ensure "Surebets" remains available for discovery
  - [x] Update navigation data structure to reflect new labeling
  - [x] Test navigation functionality after label changes
- [x] Implement new Telegram section (AC: #2)
  - [x] Create Telegram section in navigation structure
  - [x] Add routing to Pending Photos page (Story 10.1)
  - [x] Add routing to Coverage Proof Outbox page (Story 10.2)
  - [x] Add routing to Rate Limiting page (Story 10.9)
  - [x] Update page registry to include new Telegram section routes
- [x] Update Associates listing with new columns (AC: #3)
  - [x] Replace JSON profile/created/updated columns with `balance` and `pending_balance`
  - [x] Update sorting and filtering functionality to use new fields
  - [x] Integrate with `AssociateHubRepository` at `src/repositories/associate_hub_repository.py:70`
  - [x] Refresh AssociateHub UI to display new columns correctly
- [x] Update navigation tests (AC: #4)
  - [x] Update `tests/unit/test_navigation_modernization.py:1` to assert Settlement label
  - [x] Add test assertions for Telegram section existence
  - [x] Verify all navigation links work correctly
- [x] Update repository tests (AC: #5)
  - [x] Update `tests/unit/test_associate_hub_repository.py:1` to cover new balance fields
  - [x] Ensure new fields exist and carry correct values
  - [x] Test data availability to the UI layer

## Dev Notes
- Follow `docs/front-end-spec.md:1` for UX guidance
- Reference repository structure at `src/repositories/associate_hub_repository.py:70`
- Update any SQL or repo filters that expect the removed JSON/created columns so type errors do not surface
- Ensure navigation changes don't break existing user workflows
- Test navigation responsive behavior on different screen sizes

### Testing
- Test file locations: 
  - `tests/unit/test_navigation_modernization.py`
  - `tests/unit/test_associate_hub_repository.py`
- Test standards: Follow existing unit test patterns in the codebase
- Testing frameworks: pytest with UI component testing
- Navigation test updates as specified in acceptance criteria
- AssociateHub repository tests ensure new fields exist and carry correct values
- Test navigation functionality across different user roles and permissions
- Verify sorting and filtering work with new balance fields
- Test Telegram section routing to all linked pages

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-10 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
GPT-5 Codex (2025-11-10)

### Debug Log References
- 2025-11-10: `pytest tests/unit/test_navigation_modernization.py tests/unit/test_associate_hub_repository.py`

### Completion Notes List
- Updated `src/ui/app.py` plus new Streamlit pages so Settlement replaces the queue label and the Telegram section links to Pending Photos, Coverage Proof Outbox, and Rate Limiting screens.
- Moved the Coverage Proof Outbox panel into `src/ui/pages/coverage_proof_outbox_panel.py`, added dedicated Telegram pages, and exposed rate-limit telemetry via `CoverageProofService.get_rate_limit_cooldowns`.
- Reworked `AssociateHubRepository`, the Admin & Associates UI, and editor helpers so balance/pending data replaces the old columns, and confirmed Story DoD checklist items manually via repo review.

### File List
- src/ui/app.py
- src/ui/pages/coverage_proof_outbox_panel.py
- src/ui/pages/telegram_coverage_proof_outbox.py
- src/ui/pages/telegram_rate_limiting.py
- src/services/coverage_proof_service.py
- src/ui/pages/2_verified_bets.py
- src/repositories/associate_hub_repository.py
- src/ui/helpers/editor.py
- src/ui/pages/7_admin_associates.py
- tests/unit/test_navigation_modernization.py
- tests/unit/test_associate_hub_repository.py

## QA Results

### Risk Assessment
- **Complexity**: 3/5 (Medium)
- **Data Sensitivity**: Low
- **Integration Risk**: 3/5 (Medium)
- **Overall Risk Score**: 9 (Medium)

### NFR Analysis
- **Security**: PASS
- **Performance**: PASS
- **Reliability**: PASS
- **Usability**: CONCERNS
- **Maintainability**: PASS

### Test Strategy
- **Unit Tests**: Comprehensive coverage for navigation structure and repository changes
- **Integration Tests**: Critical paths identified for navigation routing and data flow
- **E2E Tests**: Workflow validation for navigation transitions and Telegram section access
- **Edge Cases**: Boundary conditions covered for balance field transitions and filtering

### Requirements Traceability
- **AC1**: ✅ Mapped to navigation structure tests in test_navigation_modernization.py
- **AC2**: ✅ Mapped to Telegram section routing tests
- **AC3**: ✅ Mapped to AssociateHub repository tests and UI integration tests
- **AC4**: ✅ Mapped to navigation modernization tests
- **AC5**: ✅ Mapped to associate hub repository field coverage tests

### Quality Gate Decision
- **Decision**: CONCERNS
- **Risk Score**: 9
- **Rationale**: The implementation successfully delivers navigation restructuring and Telegram section creation with proper test coverage. However, there are usability concerns regarding the removal of JSON profile/created/updated columns which may impact administrative workflows. The new balance fields are well-implemented with proper sorting/filtering, but the migration from metadata columns to financial columns requires careful user training and may affect existing administrative processes.
- **Critical Issues**:
  - Potential loss of administrative visibility with removal of profile/created/updated metadata
  - User workflow disruption for admins who rely on creation/update timestamps for audit trails
- **Recommendations**:
  1. Consider adding an optional admin view that shows historical metadata alongside balance information
  2. Provide user training materials for the new navigation structure and balance-focused admin interface
  3. Monitor user feedback on the navigation changes and be prepared to add breadcrumb navigation if needed
  4. Ensure audit trail functionality is preserved through other means if timestamps were critical for compliance

**QA Engineer**: Quinn - Test Architect
**Date**: 2025-11-10T13:19:00+08:00
