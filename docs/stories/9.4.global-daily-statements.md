# Story 9.4: Global Daily Statements (All Chats)

## Status
Draft

## Story
As an admin, I want to send a daily balance and pending message to every registered bookmaker chat so all partners receive consistent status updates.

## Acceptance Criteria

- [ ] Streamlit action: “Send Daily Statements to All Chats” in dashboard
  - Shows confirmation modal and a progress indicator (sent/total)
- [ ] Message content
  - Same format as Story 9.3 for each `(associate_id, bookmaker_id)`
- [ ] Selection scope
  - All active `chat_registrations`
  - Skip chats with missing registration or disabled bookmakers
- [ ] Rate limiting
  - Global cap (configurable): default 15 messages/sec
  - Per‑chat throttle: 1 message/sec
  - Respect Telegram 429 `retry_after` response; retry with backoff
- [ ] Result summary
  - Display counts: sent, failed, retried, skipped
  - Exportable log (CSV/JSON) with chat_id and error messages

## Tasks / Subtasks

- [ ] Implement async messaging queue with configurable rate limits
- [ ] Integrate computation from Story 9.3 for each chat
- [ ] UI progress + summary report
- [ ] Robust error handling and retries on 429 and transient network errors

## Dev Notes

- 150 associates × 5 bookmakers ≈ 750 chats; at 15/s, ~50 seconds total
- Use token‑bucket for global and per‑chat throttling
- Consider scheduling (cron) later; for now manual trigger is sufficient

